<!-- spinner, uses the interceptor to work -->
<ngx-spinner [bdColor]="'rgba(0, 0, 0, 0.8)'"></ngx-spinner>
<app-user-widget-cards></app-user-widget-cards>
<div class="tables">
    <div class="profiletable" >
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 class="section-heading-logs">Daily Logs</h2>
        <!-- Date Range Filter -->
        <div class="calendar-container">
          
          <div class = "filter-group">
            
            <p-button label="Date Range" severity="danger" icon="pi pi-calendar" class="calendar-button" (click)="toggleCalendar()"></p-button>
            <p-button
            severity="danger"
            label="Reset"
            icon="pi pi-refresh"
            styleClass="p-button-secondary"
            class="reset-button"
            (onClick)="resetTable()"
          />
          </div>
        </div> 
      </div>

      <!-- Date Range Calendar -->
      <div *ngIf="showCalendar" class="calendar-popup" #calendarPopup>
        <p-calendar 
          id="datepick"
          placeholder="Select Date Range"
          [iconDisplay]="'input'"
          [maxDate]="yesterday"
          inputId="icondisplay"
          [dateFormat]="'dd-MM-yy'"
          (onSelect)="onDateSelect()"
          [(ngModel)]="selectedDates"
          [showButtonBar]="false"
          selectionMode="range"
          [inline]="true"
        >
        </p-calendar>
      </div>

      <div class="card">
        <p-table [value]="filteredAttendanceLogs" scrollable="true" [scrollHeight]="'390px'" [rows]="4">
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="date">
                        Date <p-sortIcon field="date" />
                    </th>
                    <th>
                        Check-In 
                    </th>
                    <th>
                        Check-Out
                    </th>
                    <th class="status-heading">      
                        <p-dropdown
                          #dropdown
                          [options]="statusOptions"
                          [(ngModel)]="selectedStatus" 
                          placeholder="Status"
                          [autoZIndex]="true"
                          [scrollHeight]="'300px'"
                          [styleClass]="'custom-dropdown custom-dropdown-width'" 
                          (onChange)="filterByStatus()"
                          [filter]="true"
                          [appendTo]="'body'"
                        >
                        </p-dropdown>
                    </th>
                    <th>
                        Work Hours 
                    </th>
                    <th>
                        Remark
                    </th>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="6" style="text-align: center; font-weight: bold; color: gray;">
                    No data found
                  </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-log>
              
              <tr>
                <td style="width: 170px;">{{ log.date | date:'d MMM, y' }}</td>
                <td style="width: 150px;">{{ log.loginTime | date : "hh:mm a" }}</td>
                <td style="width: 150px;">{{ log.logoutTime | date : "hh:mm a" }}</td>
                <td style="width: 200px;">
                  <span [ngClass]="{'yellow-background': log.status !== 'Present' && log.status!=='On Leave', 'green-background': log.status === 'Present','red-background': log.status === 'On Leave'}">
                    {{ log.status }}
                  </span>
                </td>
                <td style="width: 120px;">
                  <span [ngClass]="{'red-background': parseFloat(log.totalWorkHour) < 8, 'green-background': parseFloat(log.totalWorkHour) >= 8}">
                    {{ log.totalWorkHour + " hrs" }}
                  </span>
                  
                  
                </td>
                <td style="width: 200px;">{{ log.remark && log.remark !== 'null' ? log.remark : 'no remarks' }}</td>
              </tr>
            </ng-template>
            
        </p-table>
    </div>
    
    </div>
    
    <div class="futureHolidays">
        <p class="section-heading-holidays">Holidays</p>
        <div class="scrollable-container">
          <p-table [value]="holidays" scrollable="true" [scrollHeight]="'390px'" [tableStyle]="{'min-width': '20rem',}" id="holidayTable">
            <ng-template pTemplate="header">
              <tr>
                <th  style="width: 20px;">Date</th>
                <th  style="width: 20px;">Name</th>
                <th  style="width: 20px;">Type</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>
              <tr [ngClass]="{
                'highlight-row': item.holidayName === 'Added Holiday' && item.holidayType === 'full_day',
                'highlight-row-half': item.holidayName === 'Added Holiday' && item.holidayType === 'half_day'
              }">
                <td  style="width: 20px;">{{ item.holidayDate | date: 'mediumDate' }}</td>
                <td  style="width: 20px;">{{ item.holidayName }}</td>
                <td  style="width: 20px;">
                  <ng-container *ngIf="item.holidayType === 'full_day'; else halfDay">
                    Full Day
                  </ng-container>
                  <ng-template #halfDay>
                    Half Day
                  </ng-template>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
</div>
