import{b as ne}from"./chunk-YPGXW24G.js";import{b as O}from"./chunk-7Q5UBWXY.js";import{A as le,D as ce,i as X,j as Z,n as te,o as v,u as oe,v as ie,y as ae,z as re}from"./chunk-POUPL73K.js";import{A as J,S as K,W as Q,ca as P,ha as $,ja as ee}from"./chunk-SUTMR7BC.js";import{Cb as U,Db as d,Eb as g,Ec as w,Fb as E,Hb as k,Hc as y,Ib as F,Jb as L,Lb as D,Mb as q,Na as V,Pa as r,Qa as h,Vb as _,Xb as b,Yb as G,_ as M,eb as f,gb as s,ha as W,ia as S,ja as T,k as z,mb as i,nb as a,o as x,ob as B,qa as j,sa as R,sb as Y,tb as C,ub as p,x as N,xb as I}from"./chunk-XTY2SKW2.js";import{a as A,b as H}from"./chunk-66YHNWRR.js";var se=()=>[0];function ge(o,m){if(o&1){let e=Y();i(0,"div",11)(1,"p-calendar",12),L("ngModelChange",function(n){S(e);let c=p();return F(c.selectedDate,n)||(c.selectedDate=n),T(n)}),C("onSelect",function(n){S(e);let c=p();return T(c.onDateSelect(n))}),a()()}if(o&2){let e=p();r(),k("ngModel",e.selectedDate),s("maxDate",e.maxDate)("showButtonBar",!1)("inline",!0)("readonlyInput",!0)("disabledDays",q(6,se))}}var Fe=(()=>{class o{api;elementRef;batchService;batchSelected=new R;batches=[];selectedBatch;placeholder="";latestLogDate;selectedDate;maxDate;showCalendar=!1;constructor(e,t,n){this.api=e,this.elementRef=t,this.batchService=n}ngOnInit(){this.getLatestDate(),this.loadBatches()}loadBatches(){this.batchService.getBatches().subscribe(e=>{this.batches=e,e.length&&(this.placeholder=e[0].batchName,this.selectedBatch=e[0],this.batchSelected.emit(this.selectedBatch))})}getLatestDate(){this.api.getWidgetCount().subscribe(e=>{e.latestDate&&(this.latestLogDate=new Date(e.latestDate),this.selectedDate=new Date(this.latestLogDate),this.maxDate=this.latestLogDate,this.api.setSelectedDate(this.selectedDate))})}toggleCalendar(){this.showCalendar=!this.showCalendar}onDateSelect(e){this.selectedDate=e,this.api.setSelectedDate(this.selectedDate),this.showCalendar=!1,this.latestLogDate=this.selectedDate,this.onDateChange(this.selectedDate)}onDateChange(e){let t={day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()};this.api.updateSelectedDate(t)}onBatchSelect(){this.batchSelected.emit(this.selectedBatch),this.selectedBatch&&(this.placeholder=this.selectedBatch.batchName)}onClickOutside(e){let t=this.elementRef.nativeElement.contains(e.target),n=e.target.closest(".dropdown-button");(!t||n)&&(this.showCalendar=!1)}static \u0275fac=function(t){return new(t||o)(h(O),h(j),h(ne))};static \u0275cmp=M({type:o,selectors:[["app-current-date"]],hostBindings:function(t,n){t&1&&C("click",function(l){return n.onClickOutside(l)},!1,V)},outputs:{batchSelected:"batchSelected"},standalone:!0,features:[D],decls:15,vars:8,consts:[[1,"card-container"],[1,"card","flex","justify-content-center"],["styleClass","p-card"],[1,"card-content"],[1,"date-container"],[1,"realtime-insight"],[1,"greeting","today"],[1,"filter-group"],["optionLabel","batchName",1,"dropdown-button",3,"ngModelChange","options","ngModel","placeholder"],["pButton","","label","Date","icon","pi pi-calendar","iconPos","right",1,"custom-button",3,"click"],["class","calendar-popup",4,"ngIf"],[1,"calendar-popup"],[3,"ngModelChange","onSelect","ngModel","maxDate","showButtonBar","inline","readonlyInput","disabledDays"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"div",1)(2,"p-card",2)(3,"div",3)(4,"div",4)(5,"div",5),d(6," Attendance Data on : "),a(),i(7,"div",6)(8,"span"),d(9),_(10,"date"),a()()(),i(11,"div",7)(12,"p-dropdown",8),L("ngModelChange",function(l){return F(n.selectedBatch,l)||(n.selectedBatch=l),l}),C("ngModelChange",function(){return n.onBatchSelect()}),a(),i(13,"button",9),C("click",function(){return n.toggleCalendar()}),a()()()()(),f(14,ge,2,7,"div",10),a()),t&2&&(r(9),g(b(10,5,n.latestLogDate,"d MMM yyyy")),r(3),s("options",n.batches),k("ngModel",n.selectedBatch),s("placeholder",n.placeholder),r(2),s("ngIf",n.showCalendar))},dependencies:[Z,X,y,ee,$,v,te,P,K,Q,w,ie,oe],styles:[".card-container[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;margin-top:5px}[_nghost-%COMP%]     .p-card{margin-top:5px;text-align:center;border-radius:10px}[_nghost-%COMP%]     .p-card-content{padding:0}[_nghost-%COMP%]     .p-card-body{padding:1rem}.p-calendar[_ngcontent-%COMP%]{position:absolute;z-index:1000}.card-container[_ngcontent-%COMP%]{position:relative}.calendar-popup[_ngcontent-%COMP%]{position:absolute;top:140px;right:-150px;z-index:1000;background:#fff;box-shadow:0 4px 8px #0000001a;border-radius:4px;padding:10px}[_nghost-%COMP%]     .calendar-popup .p-calendar{width:300px;height:307px}[_nghost-%COMP%]     .calendar-popup .p-calendar .p-datepicker{border:0}[_nghost-%COMP%]     .calendar-popup .p-calendar .p-datepicker table td, [_nghost-%COMP%]     .calendar-popup .p-calendar .p-datepicker table th{padding:0}.custom-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:var(--primary-color);color:#fff;border:none;border-radius:4px}.filter-group[_ngcontent-%COMP%]{display:flex;gap:10px}.date-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px;margin-bottom:5%}.date[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.logo-time[_ngcontent-%COMP%]{display:flex;font-size:20px;gap:10px;justify-content:space-around;min-width:170px}.logo-time[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:32px}.logo-time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{min-width:110px}.realtime-insight[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;color:#888}.today[_ngcontent-%COMP%]{font-size:22px}.greeting[_ngcontent-%COMP%]{font-size:32px;font-weight:bolder}[_nghost-%COMP%]     .p-dropdown{background-color:var(--primary-color);font-size:1rem;font-weight:700}[_nghost-%COMP%]     .p-dropdown .p-dropdown-trigger{background:transparent;color:#fff;width:3rem;border-top-right-radius:6px;border-bottom-right-radius:6px}[_nghost-%COMP%]     .p-dropdown-panel .p-dropdown-items .p-dropdown-item{margin:0;padding:.75rem 1.25rem;border:0 none;color:var(--nav-bar-hover-color);font-weight:700;background:transparent;transition:box-shadow .2s;border-radius:0}[_nghost-%COMP%]     .p-dropdown-panel .p-dropdown-items .p-dropdown-item:hover{background-color:#eaeaea3d}[_nghost-%COMP%]     .p-dropdown .p-dropdown-label.p-placeholder{color:#fff}[_nghost-%COMP%]     .p-dropdown-panel .p-dropdown-items .p-dropdown-item.p-highlight.p-focus{background:#ff98983d}@media (max-width: 1024px){.card-content[_ngcontent-%COMP%]{padding:10px}.logo-time[_ngcontent-%COMP%]{font-size:26px;gap:10px;justify-content:space-around;min-width:200px}.logo-time[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px}.logo-time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{min-width:130px}.realtime-insight[_ngcontent-%COMP%]{font-size:16px;color:#888}.today[_ngcontent-%COMP%]{font-size:28px}}@media only screen and (min-width: 820px){.card-container[_ngcontent-%COMP%]{width:280px}}@media (max-width: 768px){.card-container[_ngcontent-%COMP%]{margin:auto}.card-content[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-around;gap:20px}.logo-time[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]     .p-card{margin-top:10px;text-align:center;border-radius:10px}}@media (max-width: 650px){.logo-time[_ngcontent-%COMP%]{font-size:24px}}@media (max-width: 480px){.card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.logo-time[_ngcontent-%COMP%]{display:flex;align-items:center}}"]})}return o})();function me(o,m){if(o&1&&(i(0,"tr")(1,"th"),d(2,"ID"),a(),i(3,"th"),d(4,"Trainee"),a(),i(5,"th",8),d(6),B(7,"p-sortIcon",9),a()()),o&2){let e=p();r(5),I("pSortableColumn",e.sortableColumn),r(),E(" ",e.toggleField,""),r(),I("field",e.sortableColumn)}}function he(o,m){if(o&1&&(i(0,"strong"),d(1),_(2,"date"),a()),o&2){let e=p().$implicit,t=p();r(),E(" ",b(2,1,t.getTime(e),"hh:mm a")," ")}}function fe(o,m){o&1&&(i(0,"strong"),d(1,"N/A"),a())}function ue(o,m){if(o&1&&(i(0,"tr")(1,"td")(2,"strong"),d(3),a()(),i(4,"td")(5,"strong"),d(6),a()(),i(7,"td"),f(8,he,3,4,"strong",10)(9,fe,2,0,"ng-template",null,0,G),a()()),o&2){let e=m.$implicit,t=U(10),n=p();r(3),g(e.employeeCode),r(3),g(e.name),r(2),s("ngIf",n.getTime(e))("ngIfElse",t)}}function xe(o,m){if(o&1&&(i(0,"div",11),B(1,"i",12),i(2,"p"),d(3,'No data found for "'),i(4,"span"),d(5),a(),d(6,'" on '),i(7,"span"),d(8),_(9,"date"),a()()()),o&2){let e=p();r(5),g(e.tableHeader),r(3),g(b(9,2,e.tableDate,"mediumDate"))}}var Ue=(()=>{class o{attendanceService;selectedBatch;tableHeader="On Time";toggleField="Check-In";tableDate=new Date;widgetAttendance=[];sortableColumn="loginTime";constructor(e){this.attendanceService=e}ngOnInit(){this.attendanceService.selectedDate$.subscribe(e=>{this.tableDate=e||this.attendanceService.getSelectedDate(),this.fetchAttendanceLogs()}),this.fetchAttendanceLogs()}ngOnChanges(e){(e.selectedBatch||e.tableHeader)&&(this.setSortableColumn(),this.fetchAttendanceLogs())}setSortableColumn(){this.sortableColumn=this.tableHeader==="Early Departures"?"logoutTime":"loginTime"}fetchAttendanceLogs(){let{day:e,month:t,year:n}=this.extractDateParts(this.tableDate);this.attendanceService.updateSelectedDate({day:e,month:t,year:n});let c=this.getDataFetchFunction(e,t,n);c?c().pipe(N(this.handleFetchError.bind(this))).subscribe(l=>this.widgetAttendance=this.filterByBatch(l)):console.error("Unknown table header:",this.tableHeader)}extractDateParts(e){return{day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}}getDataFetchFunction(e,t,n){let c=l=>l.filter(u=>u.batch===this.selectedBatch?.batchName).map(u=>H(A({},u),{loginTime:new Date(u.loginTime),logoutTime:new Date(u.logoutTime)}));return{"On Time":()=>this.attendanceService.onTimeLogs(e,t,n).pipe(x(l=>c(l.earlyArrivals))),"Late Arrivals":()=>this.attendanceService.lateArrivalLogs(e,t,n).pipe(x(l=>c(l.lateArrivals))),Absent:()=>this.attendanceService.absenteeLogs(e,t,n).pipe(x(l=>c(l.absentees))),"Early Departures":()=>this.attendanceService.earlyDeparturesLogs(e,t,n).pipe(x(l=>c(l.earlyDepartures)))}[this.tableHeader]}filterByBatch(e){return this.selectedBatch?e.filter(t=>t.batch===this.selectedBatch.batchName):e}handleFetchError(e){return console.error("Error fetching attendance logs:",e.message),this.widgetAttendance=[],z([])}getTime(e){let t=this.tableHeader==="Early Departures"?e.logoutTime:e.loginTime;return t instanceof Date&&!isNaN(t.getTime())?t:null}static \u0275fac=function(t){return new(t||o)(h(O))};static \u0275cmp=M({type:o,selectors:[["app-widget-table"]],inputs:{selectedBatch:"selectedBatch",tableHeader:"tableHeader",toggleField:"toggleField"},standalone:!0,features:[W,D],decls:9,vars:6,consts:[["notAvailable",""],[1,"container"],[1,"search-filter"],[1,"card","table-container"],["scrollHeight","300px",3,"value","scrollable","rows","sortMode"],["pTemplate","header"],["pTemplate","body"],["class","empty-state-container",4,"ngIf"],[3,"pSortableColumn"],[3,"field"],[4,"ngIf","ngIfElse"],[1,"empty-state-container"],[1,"fas","fa-exclamation-circle","not-found-icon"]],template:function(t,n){t&1&&(i(0,"div",1)(1,"div",2)(2,"h2"),d(3),a()(),i(4,"div",3)(5,"p-table",4),f(6,me,8,3,"ng-template",5)(7,ue,11,4,"ng-template",6),a(),f(8,xe,10,5,"div",7),a()()),t&2&&(r(3),g(n.tableHeader),r(2),s("value",n.widgetAttendance)("scrollable",!0)("rows",4)("sortMode","single"),r(3),s("ngIf",n.widgetAttendance.length===0))},dependencies:[ce,ae,J,re,le,v,P,y,w],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;border-radius:8px;box-shadow:0 0 10px #0000001a}.search-filter[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:5px}#search-bar[_ngcontent-%COMP%]{flex:1;margin-right:20px}#datepick[_ngcontent-%COMP%]{margin-right:20px}.status-work-from-office[_ngcontent-%COMP%]{color:green;background-color:#e0f7e9;padding:2px 4px;border-radius:3px}.status-absent[_ngcontent-%COMP%]{color:#ea454c;background-color:#ffe0e0;padding:2px 4px;border-radius:3px}.status-late-arrival[_ngcontent-%COMP%]{color:orange;background-color:#fff4e0;padding:2px 4px;border-radius:3px}.time-on-time[_ngcontent-%COMP%]{color:green;background-color:#e0f7e9;padding:2px 4px;border-radius:3px}.time-late[_ngcontent-%COMP%]{color:orange;background-color:#fff4e0;padding:2px 4px;border-radius:3px}.time-very-late[_ngcontent-%COMP%]{color:#ea454c;background-color:#ffe0e0;padding:2px 4px;border-radius:3px}.invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]     .p-inputtext{padding:8px}[_nghost-%COMP%]     h2{margin:0}.no-data-img[_ngcontent-%COMP%]{width:25%}.empty-state-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;height:100%;padding:20px;color:#555;font-family:Roboto,sans-serif}.empty-state-container[_ngcontent-%COMP%]   .not-found-icon[_ngcontent-%COMP%]{font-size:7em;color:#f38c89;margin-bottom:30px}.empty-state-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.2em;color:#333;line-height:1.5;margin:0}.empty-state-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#ea454c;font-weight:700}"]})}return o})();export{Fe as a,Ue as b};
